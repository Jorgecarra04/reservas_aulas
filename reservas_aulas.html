<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reserva de Aulas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 28px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .login-container {
            background: white;
            max-width: 450px;
            margin: 100px auto;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .login-container h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .content-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .content-card.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .card-info {
            color: #666;
            margin: 5px 0;
            font-size: 14px;
        }

        .card-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideDown 0.3s ease;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #667eea;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-admin {
            background: #ffc107;
            color: #000;
        }

        .badge-profesor {
            background: #17a2b8;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- Pantalla de Login/Registro -->
    <div id="loginScreen" class="login-container">
        <h2>üéì Sistema de Reserva de Aulas</h2>
        
        <div id="alertContainer"></div>
        
        <div style="margin-bottom: 20px; text-align: center;">
            <button class="btn" style="margin-right: 10px;" onclick="showLogin()">Iniciar Sesi√≥n</button>
            <button class="btn btn-secondary" onclick="showRegister()">Registrarse</button>
        </div>

        <!-- Formulario Login -->
        <form id="loginForm" onsubmit="login(event)">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="profesor@colegio.com" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Entrar</button>
        </form>

        <!-- Formulario Registro -->
        <form id="registerForm" onsubmit="register(event)" style="display: none;">
            <div class="form-group">
                <label>Nombre</label>
                <input type="text" id="regNombre" placeholder="Juan P√©rez" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="juan@colegio.com" required>
            </div>
            <div class="form-group">
                <label>Contrase√±a</label>
                <input type="password" id="regPassword" placeholder="M√≠nimo 6 caracteres" required minlength="6">
            </div>
            <div class="form-group">
                <label>Rol</label>
                <select id="regRole" required>
                    <option value="">Selecciona tu rol</option>
                    <option value="ROLE_PROFESOR">Profesor</option>
                    <option value="ROLE_ADMIN">Administrador</option>
                </select>
            </div>
            <button type="submit" class="btn btn-success" style="width: 100%;">Registrarse</button>
        </form>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div id="mainApp" style="display: none;">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>üéì Sistema de Reserva de Aulas</h1>
                <div class="user-info">
                    <span class="user-badge" id="userBadge"></span>
                    <button class="btn btn-secondary" onclick="logout()">Cerrar Sesi√≥n</button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('aulas')">üìö Aulas</button>
                <button class="tab" onclick="showTab('reservas')">üìÖ Mis Reservas</button>
                <button class="tab" onclick="showTab('horarios')">‚è∞ Horarios</button>
                <button class="tab" id="adminTab" onclick="showTab('admin')" style="display: none;">‚öôÔ∏è Administraci√≥n</button>
            </div>

            <div id="alertMainContainer"></div>

            <!-- Contenido Aulas -->
            <div id="aulasContent" class="content-card active">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Aulas Disponibles</h2>
                    <div>
                        <input type="number" id="filterCapacidad" placeholder="Capacidad m√≠nima" style="padding: 10px; border-radius: 5px; border: 1px solid #ddd; margin-right: 10px;">
                        <label style="margin-left: 10px;">
                            <input type="checkbox" id="filterOrdenadores"> Solo aulas con ordenadores
                        </label>
                        <button class="btn btn-primary" onclick="loadAulas()">Filtrar</button>
                    </div>
                </div>
                <div class="grid" id="aulasGrid"></div>
            </div>

            <!-- Contenido Reservas -->
            <div id="reservasContent" class="content-card">
                <h2 style="margin-bottom: 20px;">Mis Reservas</h2>
                <div class="grid" id="reservasGrid"></div>
            </div>

            <!-- Contenido Horarios -->
            <div id="horariosContent" class="content-card">
                <h2 style="margin-bottom: 20px;">Tramos Horarios</h2>
                <div id="horariosGrid"></div>
            </div>

            <!-- Contenido Admin -->
            <div id="adminContent" class="content-card">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="statAulas">0</div>
                        <div class="stat-label">Aulas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statReservas">0</div>
                        <div class="stat-label">Reservas Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statHorarios">0</div>
                        <div class="stat-label">Tramos Horarios</div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showModal('createAulaModal')">‚ûï Nueva Aula</button>
                    <button class="btn btn-primary" onclick="showModal('createHorarioModal')">‚ûï Nuevo Horario</button>
                </div>

                <h3 style="margin: 30px 0 20px 0;">Gesti√≥n de Aulas</h3>
                <div class="grid" id="adminAulasGrid"></div>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Reserva -->
    <div id="createReservaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Reserva</h3>
                <button class="close-modal" onclick="closeModal('createReservaModal')">&times;</button>
            </div>
            <form onsubmit="createReserva(event)">
                <input type="hidden" id="reservaAulaId">
                <div class="form-group">
                    <label>Aula</label>
                    <input type="text" id="reservaAulaNombre" readonly style="background: #f0f0f0;">
                </div>
                <div class="form-group">
                    <label>Fecha</label>
                    <input type="date" id="reservaFecha" required>
                </div>
                <div class="form-group">
                    <label>Tramo Horario</label>
                    <select id="reservaTramo" required>
                        <option value="">Selecciona un horario</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Motivo</label>
                    <textarea id="reservaMotivo" rows="3" required minlength="5" maxlength="500"></textarea>
                </div>
                <div class="form-group">
                    <label>N√∫mero de Asistentes</label>
                    <input type="number" id="reservaAsistentes" required min="1">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Crear Reserva</button>
            </form>
        </div>
    </div>

    <!-- Modal Nueva Aula -->
    <div id="createAulaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Aula</h3>
                <button class="close-modal" onclick="closeModal('createAulaModal')">&times;</button>
            </div>
            <form onsubmit="createAula(event)">
                <div class="form-group">
                    <label>Nombre</label>
                    <input type="text" id="aulaNombre" required>
                </div>
                <div class="form-group">
                    <label>Capacidad</label>
                    <input type="number" id="aulaCapacidad" required min="1" max="500">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="aulaOrdenadores"> Es aula de ordenadores
                    </label>
                </div>
                <div class="form-group">
                    <label>N√∫mero de Ordenadores</label>
                    <input type="number" id="aulaNumOrdenadores" value="0" min="0">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Crear Aula</button>
            </form>
        </div>
    </div>

    <!-- Modal Nuevo Horario -->
    <div id="createHorarioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Tramo Horario</h3>
                <button class="close-modal" onclick="closeModal('createHorarioModal')">&times;</button>
            </div>
            <form onsubmit="createHorario(event)">
                <div class="form-group">
                    <label>D√≠a de la Semana</label>
                    <select id="horarioDia" required>
                        <option value="LUNES">Lunes</option>
                        <option value="MARTES">Martes</option>
                        <option value="MIERCOLES">Mi√©rcoles</option>
                        <option value="JUEVES">Jueves</option>
                        <option value="VIERNES">Viernes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Sesi√≥n del D√≠a</label>
                    <input type="number" id="horarioSesion" required min="1" max="10">
                </div>
                <div class="form-group">
                    <label>Hora Inicio</label>
                    <input type="time" id="horarioInicio" required>
                </div>
                <div class="form-group">
                    <label>Hora Fin</label>
                    <input type="time" id="horarioFin" required>
                </div>
                <div class="form-group">
                    <label>Tipo</label>
                    <select id="horarioTipo" required>
                        <option value="LECTIVA">Lectiva</option>
                        <option value="RECREO">Recreo</option>
                        <option value="MEDIODIA">Mediod√≠a</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Crear Horario</button>
            </form>
        </div>
    </div>

    <script>
        // Configuraci√≥n de la API
        const API_URL = 'http://localhost:8080';
        let token = null;
        let currentUser = null;

        // Verificar si hay sesi√≥n guardada
        if (localStorage.getItem('token')) {
            token = localStorage.getItem('token');
            currentUser = JSON.parse(localStorage.getItem('user'));
            showMainApp();
        }

        // Funciones de autenticaci√≥n
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        async function login(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    token = data.token;
                    currentUser = data.usuario;
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    showMainApp();
                } else {
                    const error = await response.json();
                    showAlert(error.mensaje || 'Credenciales incorrectas', 'error');
                }
            } catch (error) {
                showAlert('Error al conectar con el servidor', 'error');
            }
        }

        async function register(e) {
            e.preventDefault();
            const data = {
                nombre: document.getElementById('regNombre').value,
                email: document.getElementById('regEmail').value,
                password: document.getElementById('regPassword').value,
                role: document.getElementById('regRole').value
            };

            try {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    const result = await response.json();
                    token = result.token;
                    currentUser = result.usuario;
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    showMainApp();
                } else {
                    const error = await response.json();
                    showAlert(error.mensaje || 'Error al registrar', 'error');
                }
            } catch (error) {
                showAlert('Error al conectar con el servidor', 'error');
            }
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            token = null;
            currentUser = null;
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            showLogin();
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            document.getElementById('userBadge').textContent = `${currentUser.nombre} (${currentUser.role === 'ROLE_ADMIN' ? 'Admin' : 'Profesor'})`;
            
            if (currentUser.role === 'ROLE_ADMIN') {
                document.getElementById('adminTab').style.display = 'block';
            }

            loadAulas();
            loadHorarios();
        }

        // Funciones de navegaci√≥n
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-card').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tab}Content`).classList.add('active');

            if (tab === 'aulas') loadAulas();
            if (tab === 'reservas') loadReservas();
            if (tab === 'horarios') loadHorarios();
            if (tab === 'admin') loadAdminData();
        }

        // Funciones de API
        async function apiCall(endpoint, options = {}) {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            };

            const response = await fetch(`${API_URL}${endpoint}`, {
                ...defaultOptions,
                ...options,
                headers: { ...defaultOptions.headers, ...options.headers }
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.mensaje || 'Error en la petici√≥n');
            }

            return response.json();
        }

        async function loadAulas() {
            const capacidad = document.getElementById('filterCapacidad')?.value;
            const ordenadores = document.getElementById('filterOrdenadores')?.checked;
            
            let url = '/aulas';
            if (capacidad) url += `?capacidad=${capacidad}`;
            if (ordenadores) url += (capacidad ? '&' : '?') + 'ordenadores=true';

            try {
                const aulas = await apiCall(url);
                const grid = document.getElementById('aulasGrid');
                
                if (aulas.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><p>No se encontraron aulas</p></div>';
                    return;
                }

                grid.innerHTML = aulas.map(aula => `
                    <div class="card">
                        <h3>${aula.nombre}</h3>
                        <div class="card-info">üë• Capacidad: ${aula.capacidad} personas</div>
                        <div class="card-info">üíª ${aula.esAulaDeOrdenadores ? `${aula.numeroOrdenadores} ordenadores` : 'Sin ordenadores'}</div>
                        <div class="card-actions">
                            <button class="btn btn-primary" onclick="openReservaModal(${aula.id}, '${aula.nombre}', ${aula.capacidad})">Reservar</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function loadReservas() {
            try {
                const reservas = await apiCall('/reservas');
                const grid = document.getElementById('reservasGrid');
                
                const misReservas = reservas.filter(r => r.usuario.id === currentUser.id);

                if (misReservas.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><p>No tienes reservas activas</p></div>';
                    return;
                }

                grid.innerHTML = misReservas.map(reserva => `
                    <div class="card">
                        <h3>${reserva.aula.nombre}</h3>
                        <div class="card-info">üìÖ Fecha: ${reserva.fecha}</div>
                        <div class="card-info">‚è∞ ${reserva.tramoHorario.diaSemana} - ${reserva.tramoHorario.horaInicio} a ${reserva.tramoHorario.horaFin}</div>
                        <div class="card-info">üìù ${reserva.motivo}</div>
                        <div class="card-info">üë• ${reserva.numeroAsistentes} asistentes</div>
                        <div class="card-actions">
                            <button class="btn btn-danger" onclick="deleteReserva(${reserva.id})">Eliminar</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function loadHorarios() {
            try {
                const horarios = await apiCall('/tramo-horario');
                const grid = document.getElementById('horariosGrid');
                
                const dias = ['LUNES', 'MARTES', 'MIERCOLES', 'JUEVES', 'VIERNES'];
                
                grid.innerHTML = dias.map(dia => {
                    const horariosDia = horarios.filter(h => h.diaSemana === dia);
                    return `
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: #667eea; margin-bottom: 15px;">${dia}</h3>
                            <div class="grid">
                                ${horariosDia.map(h => `
                                    <div class="card">
                                        <h3>Sesi√≥n ${h.sesionDia}</h3>
                                        <div class="card-info">‚è∞ ${h.horaInicio} - ${h.horaFin}</div>
                                        <div class="card-info">üìö Tipo: ${h.tipo}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function loadAdminData() {
            try {
                const aulas = await apiCall('/aulas');
                const reservas = await apiCall('/reservas');
                const horarios = await apiCall('/tramo-horario');

                document.getElementById('statAulas').textContent = aulas.length;
                document.getElementById('statReservas').textContent = reservas.length;
                document.getElementById('statHorarios').textContent = horarios.length;

                const grid = document.getElementById('adminAulasGrid');
                grid.innerHTML = aulas.map(aula => `
                    <div class="card">
                        <h3>${aula.nombre}</h3>
                        <div class="card-info">üë• Capacidad: ${aula.capacidad}</div>
                        <div class="card-info">üíª ${aula.esAulaDeOrdenadores ? `${aula.numeroOrdenadores} ordenadores` : 'Sin ordenadores'}</div>
                        <div class="card-actions">
                            <button class="btn btn-danger" onclick="deleteAula(${aula.id})">Eliminar</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        // Modal functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            if (modalId === 'createReservaModal') {
                loadHorariosSelect();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function openReservaModal(aulaId, aulaNombre, capacidad) {
            document.getElementById('reservaAulaId').value = aulaId;
            document.getElementById('reservaAulaNombre').value = aulaNombre;
            document.getElementById('reservaAsistentes').max = capacidad;
            
            // Establecer fecha m√≠nima como hoy
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reservaFecha').min = today;
            
            showModal('createReservaModal');
        }

        async function loadHorariosSelect() {
            try {
                const horarios = await apiCall('/tramo-horario');
                const select = document.getElementById('reservaTramo');
                
                select.innerHTML = '<option value="">Selecciona un horario</option>';
                
                const dias = ['LUNES', 'MARTES', 'MIERCOLES', 'JUEVES', 'VIERNES'];
                
                dias.forEach(dia => {
                    const horariosDia = horarios.filter(h => h.diaSemana === dia);
                    if (horariosDia.length > 0) {
                        const group = document.createElement('optgroup');
                        group.label = dia;
                        horariosDia.forEach(h => {
                            const option = document.createElement('option');
                            option.value = h.id;
                            option.textContent = `Sesi√≥n ${h.sesionDia}: ${h.horaInicio} - ${h.horaFin} (${h.tipo})`;
                            group.appendChild(option);
                        });
                        select.appendChild(group);
                    }
                });
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        // CRUD Operations
        async function createReserva(e) {
            e.preventDefault();
            
            const data = {
                fecha: document.getElementById('reservaFecha').value,
                motivo: document.getElementById('reservaMotivo').value,
                numeroAsistentes: parseInt(document.getElementById('reservaAsistentes').value),
                aulaId: parseInt(document.getElementById('reservaAulaId').value),
                tramoHorarioId: parseInt(document.getElementById('reservaTramo').value)
            };

            try {
                await apiCall('/reservas', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                
                showAlert('Reserva creada exitosamente', 'success', true);
                closeModal('createReservaModal');
                e.target.reset();
                loadReservas();
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function deleteReserva(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta reserva?')) return;

            try {
                await apiCall(`/reservas/${id}`, { method: 'DELETE' });
                showAlert('Reserva eliminada exitosamente', 'success', true);
                loadReservas();
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function createAula(e) {
            e.preventDefault();
            
            const data = {
                nombre: document.getElementById('aulaNombre').value,
                capacidad: parseInt(document.getElementById('aulaCapacidad').value),
                esAulaDeOrdenadores: document.getElementById('aulaOrdenadores').checked,
                numeroOrdenadores: parseInt(document.getElementById('aulaNumOrdenadores').value)
            };

            try {
                await apiCall('/aulas', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                
                showAlert('Aula creada exitosamente', 'success', true);
                closeModal('createAulaModal');
                e.target.reset();
                loadAdminData();
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function deleteAula(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta aula?')) return;

            try {
                await apiCall(`/aulas/${id}`, { method: 'DELETE' });
                showAlert('Aula eliminada exitosamente', 'success', true);
                loadAdminData();
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        async function createHorario(e) {
            e.preventDefault();
            
            const data = {
                diaSemana: document.getElementById('horarioDia').value,
                sesionDia: parseInt(document.getElementById('horarioSesion').value),
                horaInicio: document.getElementById('horarioInicio').value + ':00',
                horaFin: document.getElementById('horarioFin').value + ':00',
                tipo: document.getElementById('horarioTipo').value
            };

            try {
                await apiCall('/tramo-horario', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                
                showAlert('Horario creado exitosamente', 'success', true);
                closeModal('createHorarioModal');
                e.target.reset();
                loadHorarios();
                loadAdminData();
            } catch (error) {
                showAlert(error.message, 'error', true);
            }
        }

        // Alert system
        function showAlert(message, type = 'success', isMain = false) {
            const container = isMain ? document.getElementById('alertMainContainer') : document.getElementById('alertContainer');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            
            const alert = document.createElement('div');
            alert.className = `alert ${alertClass}`;
            alert.textContent = message;
            
            container.innerHTML = '';
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>